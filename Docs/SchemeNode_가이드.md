# SchemeNode 클래스 가이드

## 개요

`SchemeNode` 클래스는 Excel2YAML 애드인에서 엑셀 시트의 스키마 구조를 구성하는 개별 노드를 표현하는 핵심 클래스입니다. 이 클래스는 엑셀 형태로 정의된 스키마를 트리 구조로 변환하여 YAML 출력을 생성하는 데 중요한 역할을 합니다. 각 노드는 계층적 데이터 구조의 요소를 나타내며, 다양한 타입과 관계를 통해 복잡한 데이터 형태를 표현할 수 있습니다.

## 노드 타입

`SchemeNode`는 다음과 같은 타입을 가질 수 있습니다:

### `SchemeNodeType` 열거형

```csharp
public enum SchemeNodeType
{
    PROPERTY,  // 일반 속성
    KEY,       // 키 노드
    VALUE,     // 값 노드
    MAP,       // 맵(객체) 컨테이너
    ARRAY,     // 배열 컨테이너
    IGNORE     // 무시할 필드
}
```

각 타입의 의미:

- **PROPERTY**: 기본 속성 노드로, 이름과 값을 가집니다.
- **KEY**: 해시 맵이나 사전의 키를 제공하는 특수 노드입니다.
- **VALUE**: KEY 노드와 함께 사용되며, 키에 매핑되는 값을 제공합니다.
- **MAP**: 이름-값 쌍의 컬렉션을 포함하는 컨테이너입니다(JSON 객체와 유사).
- **ARRAY**: 값의 순서 있는 컬렉션을 포함하는 컨테이너입니다.
- **IGNORE**: 변환 과정에서 무시할 필드를 나타냅니다.

## 스키마 정의 방식

엑셀에서 스키마를 정의하는 방법은 다음과 같습니다:

### 1. 루트 레벨 정의

엑셀 시트의 첫 번째 행에는 루트 레벨 스키마를 정의합니다:

- **배열 루트**: `$[]`를 사용하여 배열 형태의 루트 노드 지정
- **맵 루트**: `${}`를 사용하여 맵(객체) 형태의 루트 노드 지정

### 2. 속성 정의

루트 아래에 속성들을 정의합니다:

- **기본 속성**: 단순 필드명 (예: `Id`, `Name`, `Comment`)
- **배열 속성**: 필드명 뒤에 `$[]` 추가 (예: `Materials$[]`, `AttackPower$[]`)
- **맵 속성**: 필드명 뒤에 `${}` 추가 (예: `SubStatus${}`)
- **중첩 구조**: 병합된 셀을 사용하여 계층 구조 표현

### 3. 키-값 쌍 정의

특별한 키-값 관계를 정의할 때는:

- **key**: 키로 사용할 필드 지정
- **value**: 값으로 사용할 필드 지정

### 4. 스키마 영역 구분

`$scheme_end` 마커를 사용하여 스키마 정의 영역과 데이터 영역을 구분합니다.

## 실제 스키마 예시 설명

### 기본 배열 구조 (WeaponLevelUpInfo)

```
       $[]
^      ${}
^ Rarity Level NeedExp
^ ^     ^     ^
$scheme_end
```

위 스키마는 다음을 의미합니다:
- 루트는 배열(`$[]`)
- 배열의 각 항목은 객체(`${}`)
- 각 객체는 'Rarity', 'Level', 'NeedExp' 세 속성을 가짐

YAML 결과:
```yaml
- Rarity: Common
  Level: 2
  NeedExp: 150
- Rarity: Common
  Level: 3
  NeedExp: 150
# ... 이하 생략
```

### 중첩 배열 구조 (WeaponDecompInfo)

```
       $[]
^      ${}
^ Rarity    Materials$[]
^ ^                ${}
^ ^         Id    Count
$scheme_end
```

위 스키마는 다음을 의미합니다:
- 루트는 배열(`$[]`)
- 배열의 각 항목은 객체(`${}`)
- 각 객체는 'Rarity' 속성과 'Materials' 배열을 가짐
- 'Materials' 배열의 각 항목은 'Id'와 'Count' 속성을 가진 객체

YAML 결과:
```yaml
- Rarity: Common
  Materials: 
    - Id: 2101001
      Count: 5
# ... 이하 생략
```

### 복잡한 중첩 구조 (WeaponInfo)

```
       $[]
^      ${}
^ Id Comment WeaponType Rarity AttackPower${}          SubStatus${}               WeaponReforgeInfoId PrefabPath IsPublic
^ ^     ^        ^        ^    ModifyType Base Increase Type    ModifyType Base Increase      ^              ^         ^
$scheme_end
```

위 스키마는 다음을 의미합니다:
- 루트는 배열(`$[]`)
- 각 항목은 여러 속성을 가진 객체
- 'AttackPower'와 'SubStatus'는 각각 하위 속성을 가진 중첩 객체

YAML 결과:
```yaml
- Id: 1101101
  Comment: "원정대용 지팡이"
  WeaponType: Staff
  Rarity: Common
  AttackPower: 
    ModifyType: Add
    Base: "9.5256"
    Increase: "1.2"
  PrefabPath: "weapon:Wea_Staff_09"
  IsPublic: True
# ... 이하 생략
```

## 주요 속성

`SchemeNode` 클래스는 다음과 같은 주요 속성을 가집니다:

- **key**: 노드의 이름 또는 키
- **type**: 노드의 타입 (SchemeNodeType 열거형)
- **parent**: 부모 노드 참조
- **children**: 자식 노드 컬렉션
- **schemeRowNum**: 엑셀 시트에서 노드가 정의된 행 번호
- **schemeCellNum**: 엑셀 시트에서 노드가 정의된 열 번호

## 엑셀 구조와 YAML 출력 관계

### 1. 배열 루트와 항목

엑셀에서 `$[]`로 정의된 루트는 YAML에서 하이픈(`-`)으로 시작하는 배열 항목들로 변환됩니다.

**엑셀 스키마:**
```
$[]
${}
Id  Name
```

**YAML 출력:**
```yaml
- Id: 1
  Name: "항목1"
- Id: 2
  Name: "항목2"
```

### 2. 중첩 배열

엑셀에서 속성 이름에 `$[]`를 추가하면 해당 속성은 배열로 변환됩니다.

**엑셀 스키마:**
```
     $[]
     ${}
Id   Items$[]
           ${}
           Name Value
```

**YAML 출력:**
```yaml
- Id: 1
  Items:
    - Name: "아이템1"
      Value: 10
    - Name: "아이템2"
      Value: 20
```

### 3. 중첩 객체

엑셀에서 병합된 셀과 들여쓰기를 통해 중첩 객체를 표현합니다.

**엑셀 스키마:**
```
     $[]
     ${}
Id   Stats${}
     HP  MP  Attack
```

**YAML 출력:**
```yaml
- Id: 1
  Stats:
    HP: 100
    MP: 50
    Attack: 30
```

## 스키마 정의 시 주의사항

1. **루트 정의**: 엑셀 시트의 첫 번째 행, 첫 번째 셀에는 항상 루트 타입(`$[]` 또는 `${}`)을 지정해야 합니다.

2. **스키마 종료 마커**: `$scheme_end`를 포함한 행은 스키마 정의의 끝을 표시합니다. 이 행 이후의 내용은 데이터로 간주됩니다.

3. **병합된 셀 사용**: 계층 구조를 나타낼 때 병합된 셀을 사용하는 것이 좋습니다. 이는 상위 요소와 하위 요소 간의 관계를 명확히 표현합니다.

4. **빈 셀 처리**: 스키마에서 사용되지 않는 셀은 비워두거나 `^` 기호를 사용하여 명시적으로 무시할 수 있습니다.

5. **데이터 타입**: 기본적으로 모든 데이터는 문자열로 처리되지만, 숫자나 불리언 값은 자동으로 적절한 타입으로 변환됩니다.

## 스키마 작성 예시

### 1. 단순 배열 객체

**엑셀 스키마:**
```
$[]
${}
Id Name Value
```

**YAML 출력:**
```yaml
- Id: 1
  Name: "항목1"
  Value: 100
- Id: 2
  Name: "항목2"
  Value: 200
```

### 2. 키-값 형태의 맵

**엑셀 스키마:**
```
  ${}
  $[]
key value
```

**YAML 출력:**
```yaml
key1: value1
key2: value2
key3: value3
```

### 3. 복잡한 중첩 구조

**엑셀 스키마:**
```
       $[]
       ${}
Id     Config${}         Items$[]
       Type    Value             ${}
                               Name Count
```

**YAML 출력:**
```yaml
- Id: 1
  Config:
    Type: "A"
    Value: 10
  Items:
    - Name: "아이템1"
      Count: 5
    - Name: "아이템2"
      Count: 3
```

## 활용 시나리오

1. **게임 데이터 정의**: 캐릭터, 아이템, 스킬 등의 게임 데이터를 구조화하여 정의
2. **설정 파일 생성**: 다양한 환경 설정이나 옵션을 계층적으로 구성
3. **다국어 리소스 관리**: 여러 언어의 텍스트 리소스를 구조화하여 관리
4. **API 응답 형식 모델링**: RESTful API의 응답 형식을 미리 모델링하고 테스트

## 팁과 요령

1. **계층 구조는 병합된 셀로**: 깊은 계층 구조를 표현할 때는 상위 항목의 셀을 병합하여 시각적으로 구분하세요.

2. **배열 항목은 반복 패턴으로**: 배열 내 항목이 동일한 구조를 가질 때는 동일한 필드명을 반복해서 사용하세요.

3. **스키마 미리보기**: 복잡한 구조를 정의하기 전에 간단한 예시로 YAML 출력을 확인하여 원하는 구조가 맞는지 검증하세요.

4. **명확한 필드명 사용**: 필드명은 의미를 명확히 전달할 수 있도록 일관된 명명 규칙을 사용하세요.

5. **주석 활용**: 복잡한 스키마에는 주석을 추가하여 다른 사용자가 이해하기 쉽게 만드세요. 