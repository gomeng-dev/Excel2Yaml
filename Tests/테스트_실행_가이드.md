# 도메인 모델 단위 테스트 실행 가이드

## 개요
이 문서는 Excel2Yaml VSTO 애드인의 도메인 모델에 대한 단위 테스트를 실행하는 방법을 설명합니다.

## 테스트 구조

```
Tests/
├── Domain/
│   ├── ValueObjects/
│   │   ├── CellPositionTests.cs      # CellPosition 값 객체 테스트
│   │   └── SchemeNodeTypeTests.cs    # SchemeNodeType 값 객체 테스트
│   └── Entities/
│       ├── SchemeNodeTests.cs        # SchemeNode 엔티티 테스트
│       └── SchemeTests.cs            # Scheme 엔티티 테스트
└── TestRunner.cs                     # 테스트 실행기
```

## 테스트 실행 방법

### 1. 즉시 실행 창(Immediate Window)에서 실행

Visual Studio에서 디버깅 중일 때:

```csharp
// 모든 테스트 실행
ExcelToYamlAddin.Tests.TestRunner.RunAllTests()

// 특정 테스트 스위트만 실행
ExcelToYamlAddin.Tests.TestRunner.RunTestSuite("cellposition")
ExcelToYamlAddin.Tests.TestRunner.RunTestSuite("schemenodetype")
ExcelToYamlAddin.Tests.TestRunner.RunTestSuite("schemenode")
ExcelToYamlAddin.Tests.TestRunner.RunTestSuite("scheme")
```

### 2. Ribbon 버튼에 테스트 기능 추가 (개발용)

개발 중 테스트를 위해 Ribbon.cs에 다음 메서드를 추가할 수 있습니다:

```csharp
public void RunDomainTests(Microsoft.Office.Core.IRibbonControl control)
{
    try
    {
        // 테스트 결과를 위한 새 워크시트 생성
        var testSheet = Globals.ThisAddIn.Application.Worksheets.Add();
        testSheet.Name = $"TestResults_{DateTime.Now:yyyyMMdd_HHmmss}";
        
        // Console 출력을 StringBuilder로 리디렉션
        var sb = new StringBuilder();
        var originalOut = Console.Out;
        Console.SetOut(new StringWriter(sb));
        
        // 테스트 실행
        ExcelToYamlAddin.Tests.TestRunner.RunAllTests();
        
        // Console 출력 복원
        Console.SetOut(originalOut);
        
        // 결과를 워크시트에 출력
        var results = sb.ToString().Split('\n');
        for (int i = 0; i < results.Length; i++)
        {
            testSheet.Cells[i + 1, 1].Value = results[i];
        }
        
        // 컬럼 너비 자동 조정
        testSheet.Columns[1].AutoFit();
        
        MessageBox.Show("테스트가 완료되었습니다. 결과는 새 워크시트를 참조하세요.", 
                       "테스트 완료", MessageBoxButtons.OK, MessageBoxIcon.Information);
    }
    catch (Exception ex)
    {
        MessageBox.Show($"테스트 실행 중 오류 발생: {ex.Message}", 
                       "오류", MessageBoxButtons.OK, MessageBoxIcon.Error);
    }
}
```

### 3. ThisAddIn.cs에서 시작 시 테스트 실행 (개발용)

개발 중 자동 테스트를 위해 ThisAddIn.cs의 `ThisAddIn_Startup` 메서드에 추가:

```csharp
private void ThisAddIn_Startup(object sender, System.EventArgs e)
{
    #if DEBUG
    // 개발 모드에서만 테스트 자동 실행
    try
    {
        System.Diagnostics.Debug.WriteLine("=== 도메인 모델 테스트 실행 ===");
        ExcelToYamlAddin.Tests.TestRunner.RunAllTests();
        System.Diagnostics.Debug.WriteLine("=== 테스트 완료 ===");
    }
    catch (Exception ex)
    {
        System.Diagnostics.Debug.WriteLine($"테스트 실패: {ex.Message}");
    }
    #endif
}
```

## 테스트 케이스 설명

### CellPositionTests
- 유효한 행/열 값으로 생성
- 잘못된 행/열 값 검증
- Excel 주소 변환 (A1, Z10, AA100 등)
- 동등성 비교

### SchemeNodeTypeTests
- 정적 인스턴스 초기화 확인
- 컨테이너/동적/데이터 타입 구분
- 스키마 이름으로부터 타입 판별
- 문자열 암시적 변환

### SchemeNodeTests
- 노드 생성 및 초기화
- 부모-자식 관계 설정
- 노드 경로 계산
- 노드 복사 및 검증
- 선형화(Linear) 기능

### SchemeTests
- 스키마 생성 및 검증
- 노드 필터링 (타입별, 깊이별)
- 경로로 노드 찾기
- 스키마 복사
- 데이터 행 개수 계산

## 예상 출력

```
======================================
도메인 모델 단위 테스트 실행 시작
======================================

=== CellPosition Tests ===
✓ Constructor_ValidValues_CreatesInstance
✓ Constructor_InvalidRow_ThrowsException
✓ Constructor_InvalidColumn_ThrowsException
✓ FromAddress_ValidAddress_CreatesInstance
✓ FromAddress_InvalidAddress_ThrowsException
✓ ToAddress_ReturnsCorrectAddress
✓ Equals_SameValues_ReturnsTrue
✓ Equals_DifferentValues_ReturnsFalse
✓ ToString_ReturnsFormattedString
CellPosition 테스트 완료!

=== SchemeNodeType Tests ===
✓ StaticInstances_AreInitialized
✓ IsContainer_ReturnsCorrectValue
✓ IsDynamic_ReturnsCorrectValue
✓ CanHaveData_ReturnsCorrectValue
✓ FromSchemeName_Property_ReturnsProperty
✓ FromSchemeName_Array_ReturnsArray
✓ FromSchemeName_Map_ReturnsMap
✓ FromSchemeName_Key_ReturnsKey
✓ FromSchemeName_Value_ReturnsValue
✓ FromSchemeName_Ignore_ReturnsIgnore
✓ GetAll_ReturnsAllTypes
✓ Equals_SameType_ReturnsTrue
✓ ImplicitStringConversion_ReturnsCode
SchemeNodeType 테스트 완료!

... (이하 생략) ...

======================================
✅ 모든 테스트가 성공적으로 완료되었습니다!
======================================
```

## 주의사항

1. **VSTO 프로젝트 특성상 일반적인 단위 테스트 프레임워크(NUnit, xUnit 등)를 사용하지 않습니다.**
2. **테스트는 개발 환경에서만 실행하고, 프로덕션 빌드에서는 제외해야 합니다.**
3. **테스트 코드는 도메인 로직의 정확성을 검증하는 용도로만 사용됩니다.**
4. **Excel 관련 기능(Worksheet, Range 등)은 테스트하지 않습니다.**